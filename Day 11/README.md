# Day 11: VSD BabySoC Modelling Process

<details>
  <summary> BabySoC Modelling Process </summary>  

* We adjust the digital output value, either by increasing or decreasing it, and then feed it to the DAC model to observe the changes SoC output.

### 1. Script to install the packages.

* vsdbabysoc.v (Top-Level SoC Module)
```
   $ sudo apt install make python python3 python3-pip git iverilog gtkwave docker.io
   $ sudo chmod 666 /var/run/docker.sock
   $ cd ~
   # Install virtual environment package if not already available
   $ sudo apt install python3-venv -y
   # Create a virtual environment
   $ python3 -m venv myenv
   # Activate it virtual env
   $ source myenv/bin/activate
   # Installing the package
   $ pip install pyyaml click sandpiper-saas

```

### 2. Cloning the VSDBabySoC repository
```
$ cd ~
$ git clone https://github.com/manili/VSDBabySoC.git
```

### 3. Make the `pre_synth_sim.vcd`:
```
$ cd VSDBabySoC
$ sandpiper-saas -i ./src/module/*.tlv -o rvmyth.v --bestsv --noline -p verilog --outdir ./src/module/
```
![img1](https://github.com/Dhruvid98/SFAL-VSD-SoC-Design/blob/main/Day%2011/Images/img1.png)  

Run the following command to perform a **pre-synthesis simulation**:  
```
iverilog -o output/pre_synth_sim.out -DPRE_SYNTH_SIM  src/module/testbench.v
    -I src/include -I src/module 
cd output/pre_synth_sim
./pre_synth_sim.out
```
* The simulation result is stored in `output/pre_synth_sim` directory i.e. `pre_synth_sim.vcd`
* -DPRE_SYNTH_SIM: Defines the PRE_SYNTH_SIM macro for conditional compilation in the testbench.
  
![img2](https://github.com/Dhruvid98/SFAL-VSD-SoC-Design/blob/main/Day%2011/Images/img2.png)

### 4. Analyzing `pre_synth_sim.vcd` waveforms in gtkwave by following the command:
```
$ gtkwave output/pre_synth_sim/pre_synth_sim.vcd
```

![img3](https://github.com/Dhruvid98/SFAL-VSD-SoC-Design/blob/main/Day%2011/Images/img3.png)

The following signals are displayed.
* CLK: This is the input CLK signal of the RVMYTH core.
    * This signal comes from the PLL, originally.

* reset: This is the input reset signal of the RVMYTH core.
    * This signal comes from an external source, originally.
* OUT: This is the output OUT signal of the VSDBabySoC module. 
* RV_TO_DAC[9:0]: This is the 10-bit output [9:0] OUT port of the RVMYTH core.
    * This port comes from the RVMYTH register originally.
* OUT: This is a real datatype wire that can simulate analog values.
    * It is the output wire real OUT signal of the **DAC module**. This signal originates from the DAC.
* The synthesis process does not support real variables, so we must use the simple wire datatype for the vsdbabysoc.OUT instead. The iverilog simulator always treats wire as a digital signal. As a result, we can not see the analog output via vsdbabysoc.OUT port, and we need to **use dac.OUT** (which is a real datatype) instead.
* To view the signal as analog, set its Data Format to Analog

### Module Descriptions
<details> <summary> vsdbabysoc.v (Top-Level SoC Module) </summary>

* This is the top-level module that integrates the rvmyth, pll, and dac modules.
* [VSDBabySoC](https://github.com/manili/VSDBabySoC.git)
```
  - Inputs:
     - reset: Resets the core processor.
     - VCO_IN, ENb_CP, ENb_VCO, REF: PLL control signals.
     - VREFH: DAC reference voltage.
  - Outputs:
     - OUT: Analog output from DAC.
     - Connections:
     - RV_TO_DAC - A 10-bit bus that connects the RISC-V core output to the DAC input.
     - CLK - The clock signal generated by the PLL.
```
</details>

<details> <summary> rvmyth.v (RISC-V Core) </summary>

* Rvmyth module is a simple RISC-V based processor.
* The output is a 10-bit digital signal (OUT) to be converted by the DAC.
* [rvmyth](https://github.com/kunalg123/rvmyth/)

</details>

   </details>
